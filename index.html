// pages/index.js
import Head from 'next/head'
import { useState, useEffect } from 'react'

export default function Home() {
  // æ¨¡å—ä¸€ï¼šå·¥ä½œå¤ç›˜
  const [workExperience, setWorkExperience] = useState({
    situation: '', task: '', action: '', result: ''
  });
  const [summary, setSummary] = useState('');
  const [coreTag, setCoreTag] = useState('');
  const [workHistory, setWorkHistory] = useState([]);

  const handleWorkInputChange = (e) => {
    const { name, value } = e.target;
    setWorkExperience(prev => ({ ...prev, [name]: value }));
  };

  const generateWorkSummary = () => {
    const { situation, task, action, result } = workExperience;
    const shortSummary = `åœ¨${situation}ä¸­ï¼Œè´Ÿè´£${task}ï¼Œé‡‡å–äº†${action}ï¼Œæœ€ç»ˆ${result}`;
    const tag = task.length > 8 ? task.slice(0, 6) : 'èƒ½åŠ›æç‚¼';
    setSummary(shortSummary);
    setCoreTag(tag);

    const newEntry = {
      ...workExperience,
      summary: shortSummary,
      coreTag: tag,
      timestamp: new Date().toISOString()
    };
    const updatedHistory = [...workHistory, newEntry];
    setWorkHistory(updatedHistory);
    localStorage.setItem('workHistory', JSON.stringify(updatedHistory));
  };

  // æ¨¡å—äºŒï¼šå·¥ä½œå¡ç‚¹åˆ†æ
  const [challenge, setChallenge] = useState({
    context: '', analysis: '', reflection: ''
  });
  const [challengeHistory, setChallengeHistory] = useState([]);

  const handleChallengeChange = (e) => {
    const { name, value } = e.target;
    setChallenge(prev => ({ ...prev, [name]: value }));
  };

  const saveChallenge = () => {
    const newEntry = { ...challenge, timestamp: new Date().toISOString() };
    const updatedHistory = [...challengeHistory, newEntry];
    setChallengeHistory(updatedHistory);
    localStorage.setItem('challengeHistory', JSON.stringify(updatedHistory));
  };

  // æ¨¡å—ä¸‰ï¼šå­¦ä¹ è®¡åˆ’
  const [learning, setLearning] = useState({
    context: '', topic: '', resources: '', log: '', reflection: ''
  });
  const [learningHistory, setLearningHistory] = useState([]);

  const handleLearningChange = (e) => {
    const { name, value } = e.target;
    setLearning(prev => ({ ...prev, [name]: value }));
  };

  const saveLearning = () => {
    const newEntry = { ...learning, timestamp: new Date().toISOString() };
    const updatedHistory = [...learningHistory, newEntry];
    setLearningHistory(updatedHistory);
    localStorage.setItem('learningHistory', JSON.stringify(updatedHistory));
  };

  useEffect(() => {
    const wh = JSON.parse(localStorage.getItem('workHistory') || '[]');
    const ch = JSON.parse(localStorage.getItem('challengeHistory') || '[]');
    const lh = JSON.parse(localStorage.getItem('learningHistory') || '[]');
    setWorkHistory(wh);
    setChallengeHistory(ch);
    setLearningHistory(lh);
  }, []);

  return (
    <>
      <Head>
        <title>æˆé•¿å·¥ä½œå°</title>
      </Head>
      <main className="p-4 max-w-3xl mx-auto space-y-10">
        <h1 className="text-3xl font-bold text-center">æˆé•¿å·¥ä½œå°</h1>

        {/* æ¨¡å—ä¸€ */}
        <section>
          <h2 className="text-xl font-semibold mb-2">ğŸ§  å·¥ä½œå¤ç›˜ï¼ˆSTARï¼‰</h2>
          {["situation", "task", "action", "result"].map(field => (
            <div key={field} className="mb-3">
              <label className="block font-medium capitalize mb-1">{field}</label>
              <textarea name={field} value={workExperience[field]} onChange={handleWorkInputChange} className="w-full border rounded p-2" rows={2} />
            </div>
          ))}
          <button onClick={generateWorkSummary} className="bg-blue-600 text-white px-4 py-2 rounded">æç‚¼äº®ç‚¹ + ä¿å­˜</button>
          {summary && (
            <div className="mt-4">
              <p className="bg-gray-100 p-3 rounded">{summary}</p>
              <p className="text-sm mt-2 text-gray-600">èƒ½åŠ›æ ‡ç­¾ï¼š<span className="text-blue-700 font-semibold">{coreTag}</span></p>
            </div>
          )}
          <div className="mt-6">
            <h3 className="text-lg font-medium">ğŸ—‚ï¸ å†å²è®°å½•</h3>
            <ul className="space-y-2 mt-2">
              {workHistory.map((entry, index) => (
                <li key={index} className="border rounded p-2 text-sm">
                  <div className="text-gray-800">{entry.summary}</div>
                  <div className="text-xs text-gray-500">{new Date(entry.timestamp).toLocaleString()}</div>
                </li>
              ))}
            </ul>
          </div>
        </section>

        {/* æ¨¡å—äºŒ */}
        <section>
          <h2 className="text-xl font-semibold mb-2">ğŸš§ å·¥ä½œå¡ç‚¹åˆ†æ</h2>
          <textarea name="context" value={challenge.context} onChange={handleChallengeChange} placeholder="èƒŒæ™¯æè¿°" className="w-full border rounded p-2 mb-2" rows={2} />
          <textarea name="analysis" value={challenge.analysis} onChange={handleChallengeChange} placeholder="åˆ†æä¸è§£å†³æ–¹æ¡ˆï¼ˆå¯é™„èµ„æºé“¾æ¥ï¼‰" className="w-full border rounded p-2 mb-2" rows={3} />
          <textarea name="reflection" value={challenge.reflection} onChange={handleChallengeChange} placeholder="ç»“æœä¸åæ€" className="w-full border rounded p-2" rows={2} />
          <button onClick={saveChallenge} className="bg-green-600 text-white px-4 py-2 rounded mt-2">ä¿å­˜è®°å½•</button>
          <div className="mt-6">
            <h3 className="text-lg font-medium">ğŸ—‚ï¸ å†å²è®°å½•</h3>
            <ul className="space-y-2 mt-2">
              {challengeHistory.map((entry, index) => (
                <li key={index} className="border rounded p-2 text-sm">
                  <div className="text-gray-800">{entry.context}</div>
                  <div className="text-xs text-gray-500">{new Date(entry.timestamp).toLocaleString()}</div>
                </li>
              ))}
            </ul>
          </div>
        </section>

        {/* æ¨¡å—ä¸‰ */}
        <section>
          <h2 className="text-xl font-semibold mb-2">ğŸ“š æœªæ¥å­¦ä¹ è§„åˆ’</h2>
          <textarea name="context" value={learning.context} onChange={handleLearningChange} placeholder="ä¸ºä»€ä¹ˆå­¦ï¼ŸèƒŒæ™¯/åŠ¨æœº" className="w-full border rounded p-2 mb-2" rows={2} />
          <input name="topic" value={learning.topic} onChange={handleLearningChange} placeholder="å­¦ä¹ å†…å®¹/æŠ€èƒ½åç§°" className="w-full border rounded p-2 mb-2" />
          <textarea name="resources" value={learning.resources} onChange={handleLearningChange} placeholder="èµ„æºé“¾æ¥/è¯´æ˜" className="w-full border rounded p-2 mb-2" rows={2} />
          <textarea name="log" value={learning.log} onChange={handleLearningChange} placeholder="å­¦ä¹ è¿›å±•æè¿°" className="w-full border rounded p-2 mb-2" rows={2} />
          <textarea name="reflection" value={learning.reflection} onChange={handleLearningChange} placeholder="ä¼˜åŒ–ä¸åæ€" className="w-full border rounded p-2 mb-2" rows={2} />
          <button onClick={saveLearning} className="bg-purple-600 text-white px-4 py-2 rounded">ä¿å­˜å­¦ä¹ è®°å½•</button>
          <div className="mt-6">
            <h3 className="text-lg font-medium">ğŸ—‚ï¸ å†å²è®°å½•</h3>
            <ul className="space-y-2 mt-2">
              {learningHistory.map((entry, index) => (
                <li key={index} className="border rounded p-2 text-sm">
                  <div className="text-gray-800">å­¦ä¹ ï¼š{entry.topic}</div>
                  <div className="text-xs text-gray-500">{new Date(entry.timestamp).toLocaleString()}</div>
                </li>
              ))}
            </ul>
          </div>
        </section>
      </main>
    </>
  );
}
